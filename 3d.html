<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D in Mini World</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      color: #e6e6ff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .container {
      max-width: 1200px;
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 20px;
    }
    
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
    
    header {
      text-align: center;
      padding: 20px 0;
      width: 100%;
    }
    
    .logo {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #4cc9f0;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #4cc9f0, #4361ee, #3a0ca3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .subtitle {
      font-size: 1.2rem;
      color: #a9d6e5;
      margin-bottom: 20px;
      max-width: 800px;
    }
    
    .card {
      background: rgba(30, 30, 46, 0.8);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(92, 92, 224, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    }
    
    h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #4cc9f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    h2 i {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      padding: 10px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .upload-area {
      border: 3px dashed #4361ee;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      margin: 20px 0;
      background: rgba(67, 97, 238, 0.1);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .upload-area:hover {
      background: rgba(67, 97, 238, 0.2);
      border-color: #4cc9f0;
    }
    
    .upload-area i {
      font-size: 4rem;
      color: #4cc9f0;
      margin-bottom: 15px;
    }
    
    .upload-text {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    
    .file-name {
      margin-top: 15px;
      font-style: italic;
      color: #a9d6e5;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    input[type="file"] {
      display: none;
    }
    
    button {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      display: block;
      width: 100%;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
      margin: 20px 0;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    pre {
      background: #0d1b2a;
      color: #90e0ef;
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      max-height: 400px;
      font-family: 'Consolas', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      border: 1px solid #1d3557;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
      margin-top: 20px;
    }
    
    .step {
      display: flex;
      margin-bottom: 25px;
      align-items: flex-start;
      gap: 15px;
    }
    
    .step-number {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      font-size: 1.2rem;
      margin-top: 3px;
    }
    
    .step-content h3 {
      font-size: 1.3rem;
      margin-bottom: 8px;
      color: #4cc9f0;
    }
    
    .step-content p {
      line-height: 1.6;
      color: #caf0f8;
    }
    
    .step-link {
      display: inline-block;
      background: rgba(67, 97, 238, 0.2);
      color: #90e0ef;
      padding: 8px 15px;
      border-radius: 30px;
      text-decoration: none;
      margin-top: 10px;
      transition: all 0.3s;
      border: 1px solid #4361ee;
    }
    
    .step-link:hover {
      background: rgba(67, 97, 238, 0.4);
      transform: translateX(5px);
    }
    
    .step-link i {
      margin-right: 8px;
    }
    
    .example {
      margin-top: 15px;
      padding: 15px;
      background: rgba(13, 27, 42, 0.5);
      border-radius: 10px;
      border-left: 4px solid #4361ee;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #2a9d8f;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transform: translateX(200%);
      transition: transform 0.4s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .copied {
      position: absolute;
      top: -10px;
      right: 10px;
      background: #2a9d8f;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .copy-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(67, 97, 238, 0.3);
      color: #90e0ef;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      z-index: 10;
    }
    
    .copy-btn:hover {
      background: rgba(67, 97, 238, 0.5);
    }
    
    .output-container {
      position: relative;
    }
    
    footer {
      margin-top: 40px;
      text-align: center;
      padding: 20px;
      color: #a9d6e5;
      font-size: 0.9rem;
      border-top: 1px solid rgba(92, 92, 224, 0.3);
      width: 100%;
    }
    
    .highlight {
      color: #ff9e00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <i class="fas fa-cube"></i>
    </div>
    <h1>Chuyển đổi 3D → Mini World Script</h1>
    <p class="subtitle">Công cụ chuyển đổi mô hình 3D từ Drububu Voxelizer thành mã Lua cho Mini World</p>
  </header>
  
  <div class="container">
    <div class="card">
      <h2><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng</h2>
      
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>Truy cập công cụ Drububu Voxelizer</h3>
          <p>Nhấp vào liên kết bên dưới để mở công cụ chuyển đổi mô hình 3D sang định dạng voxel:</p>
          <a href="https://drububu.com/miscellaneous/voxelizer/?out=jso" target="_blank" class="step-link">
            <i class="fas fa-external-link-alt"></i> Mở Drububu Voxelizer
          </a>
        </div>
      </div>
      
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>Chuyển đổi mô hình 3D</h3>
          <p>Trên trang Drububu Voxelizer:</p>
          <div class="example">
            <ul>
              <li>Nhấp vào <span class="highlight">"Choose File"</span> để tải lên file 3D định dạng .obj</li>
              <li>Điều chỉnh kích thước voxel nếu cần</li>
              <li>Chọn <span class="highlight">"Export Voxels as JSON"</span></li>
              <li>Lưu file <span class="highlight">minecraft.json</span> về máy</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>Tải lên file JSON</h3>
          <p>Quay lại trang này và tải lên file <span class="highlight">minecraft.json</span> bạn vừa lưu:</p>
          <div id="uploadBox" class="upload-area">
            <i class="fas fa-cloud-upload-alt"></i>
            <div class="upload-text">Nhấp để chọn file hoặc kéo thả file vào đây</div>
            <div class="file-name">Chưa có file nào được chọn</div>
          </div>
          <input type="file" id="jsonFile" accept=".json">
        </div>
      </div>
      
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h3>Chuyển đổi và sử dụng</h3>
          <p>Nhấn nút chuyển đổi và sao chép mã Lua để sử dụng trong Mini World:</p>
          <button id="convertBtn">
            <i class="fas fa-sync-alt"></i> Chuyển đổi sang Lua Script
          </button>
          <div class="example">
            <p><strong>Lưu ý:</strong> Trong Mini World đặt khối gia củ và nhấp vào nó để dựng mô hình.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2><i class="fas fa-code"></i> Lua Script xuất ra</h2>
      <div class="output-container">
        <button class="copy-btn" id="copyBtn">
          <i class="fas fa-copy"></i> Sao chép
        </button>
        <pre id="output">// Script sẽ xuất hiện ở đây sau khi chuyển đổi</pre>
      </div>
    </div>
  </div>
  
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Thông báo</span>
  </div>
  
  <footer>
    <p>Công cụ chuyển đổi 3D sang Mini World Script | Drububu Voxelizer Converter</p>
  </footer>

  <script>
    const BlockColor = {
        "#FFCDD2": { id: 668, data: 1 },
        "#EE9A9A": { id: 668, data: 2 },
        "#E57373": { id: 669, data: 4 },
        "#EE534F": { id: 670, data: 6 },
        "#F44236": { id: 671, data: 8 },
        "#E53935": { id: 672, data: 10 },
        "#D32F2E": { id: 673, data: 12 },
        "#C62827": { id: 681, data: 0 },
        "#B61C1C": { id: 677, data: 10 },
        "#D50100": { id: 677, data: 2 },
        "#FE1743": { id: 678, data: 4 },
        "#FF5353": { id: 679, data: 6 },
        "#FF8A80": { id: 680, data: 8 },
        "#FDE0E4": { id: 681, data: 10 },
        "#F9BBD0": { id: 667, data: 1 },
        "#F48FB1": { id: 668, data: 3 },
        "#F06292": { id: 673, data: 0 },
        "#EC407A": { id: 670, data: 7 },
        "#EA1E63": { id: 671, data: 9 },
        "#D81A60": { id: 672, data: 11 },
        "#C2175B": { id: 673, data: 13 },
        "#AD1457": { id: 674, data: 15 },
        "#890E4F": { id: 676, data: 1 },
        "#C41162": { id: 677, data: 3 },
        "#F40057": { id: 678, data: 5 },
        "#FF4181": { id: 679, data: 7 },
        "#FF80AB": { id: 680, data: 9 },
        "#F9D8E3": { id: 681, data: 11 },
        "#E1BEE8": { id: 667, data: 2 },
        "#CF93D9": { id: 668, data: 4 },
        "#B968C7": { id: 669, data: 6 },
        "#AA47BC": { id: 670, data: 8 },
        "#9C28B1": { id: 669, data: 0 },
        "#8E24AA": { id: 672, data: 12 },
        "#7A1FA2": { id: 673, data: 14 },
        "#6A1B9A": { id: 677, data: 0 },
        "#4A148C": { id: 1970, data: 0 },
        "#AA00FF": { id: 677, data: 4 },
        "#D500FA": { id: 678, data: 6 },
        "#E040FC": { id: 679, data: 8 },
        "#EA80FC": { id: 680, data: 10 },
        "#EFD4F3": { id: 681, data: 12 },
        "#D0C4E8": { id: 667, data: 3 },
        "#B39DDB": { id: 1966, data: 0 },
        "#9675CE": { id: 669, data: 7 },
        "#7E57C2": { id: 670, data: 9 },
        "#673BB7": { id: 671, data: 11 },
        "#5D35B0": { id: 672, data: 13 },
        "#512DA7": { id: 673, data: 15 },
        "#45289F": { id: 675, data: 1 },
        "#301B92": { id: 1962, data: 0 },
        "#6200E9": { id: 677, data: 5 },
        "#651EFE": { id: 678, data: 7 },
        "#7C4DFF": { id: 679, data: 9 },
        "#B388FE": { id: 680, data: 11 },
        "#E8E0F7": { id: 681, data: 13 },
        "#C5CAE8": { id: 667, data: 4 },
        "#9EA8DB": { id: 668, data: 6 },
        "#7986CC": { id: 669, data: 8 },
        "#5C6BC0": { id: 670, data: 10 },
        "#3F51B5": { id: 671, data: 12 },
        "#3949AB": { id: 672, data: 14 },
        "#303E9F": { id: 675, data: 15 },
        "#283593": { id: 675, data: 2 },
        "#1A237E": { id: 1968, data: 0 },
        "#304FFF": { id: 677, data: 6 },
        "#3D5AFE": { id: 678, data: 8 },
        "#536DFE": { id: 679, data: 10 },
        "#8C9EFF": { id: 680, data: 12 },
        "#DFE2F5": { id: 681, data: 14 },
        "#BBDEFA": { id: 667, data: 5 },
        "#90CAF8": { id: 670, data: 0 },
        "#64B5F6": { id: 669, data: 9 },
        "#42A5F6": { id: 670, data: 11 },
        "#2196F3": { id: 671, data: 13 },
        "#1D89E4": { id: 678, data: 0 },
        "#1976D3": { id: 674, data: 1 },
        "#1564C0": { id: 675, data: 3 },
        "#0E47A1": { id: 676, data: 5 },
        "#2A62FF": { id: 677, data: 7 },
        "#2879FE": { id: 678, data: 9 },
        "#438AFE": { id: 679, data: 11 },
        "#82B1FF": { id: 680, data: 13 },
        "#D7EAFB": { id: 681, data: 15 },
        "#B3E5FC": { id: 667, data: 6 },
        "#81D5FA": { id: 668, data: 8 },
        "#4FC2F8": { id: 669, data: 10 },
        "#28B6F6": { id: 670, data: 12 },
        "#03A9F5": { id: 671, data: 14 },
        "#039BE6": { id: 669, data: 5 },
        "#0288D1": { id: 674, data: 2 },
        "#0277BD": { id: 675, data: 4 },
        "#00579C": { id: 676, data: 6 },
        "#0091EA": { id: 677, data: 8 },
        "#00AFFE": { id: 678, data: 10 },
        "#3FC4FF": { id: 679, data: 12 },
        "#80D8FE": { id: 680, data: 14 },
        "#D9F4FF": { id: 675, data: 12 },
        "#B2EBF2": { id: 667, data: 7 },
        "#80DEEA": { id: 668, data: 9 },
        "#4DD0E2": { id: 669, data: 11 },
        "#25C6DA": { id: 670, data: 13 },
        "#00BCD5": { id: 671, data: 15 },
        "#00ACC2": { id: 673, data: 1 },
        "#0098A6": { id: 674, data: 3 },
        "#00828F": { id: 675, data: 5 },
        "#016064": { id: 676, data: 7 },
        "#00B8D4": { id: 677, data: 9 },
        "#00E5FF": { id: 678, data: 11 },
        "#17FFFF": { id: 679, data: 13 },
        "#83FFFF": { id: 680, data: 15 },
        "#D2F5F9": { id: 682, data: 1 },
        "#B2DFDC": { id: 667, data: 8 },
        "#80CBC4": { id: 668, data: 10 },
        "#4CB6AC": { id: 669, data: 12 },
        "#26A59A": { id: 670, data: 14 },
        "#009788": { id: 672, data: 3 },
        "#00887A": { id: 673, data: 2 },
        "#00796A": { id: 674, data: 4 },
        "#00695A": { id: 675, data: 6 },
        "#004C3F": { id: 676, data: 8 },
        "#01BFA5": { id: 676, data: 0 },
        "#1DE9B6": { id: 678, data: 12 },
        "#64FEDA": { id: 679, data: 14 },
        "#A7FEEB": { id: 674, data: 14 },
        "#D1EFED": { id: 682, data: 2 },
        "#C8E6CA": { id: 667, data: 9 },
        "#A5D6A7": { id: 668, data: 11 },
        "#80C783": { id: 669, data: 13 },
        "#66BB6A": { id: 670, data: 15 },
        "#4CB050": { id: 672, data: 1 },
        "#43A047": { id: 673, data: 3 },
        "#398E3D": { id: 674, data: 5 },
        "#2F7D32": { id: 680, data: 0 },
        "#1C5E20": { id: 1971, data: 0 },
        "#01C853": { id: 677, data: 11 },
        "#00E676": { id: 678, data: 13 },
        "#69F0AE": { id: 679, data: 15 },
        "#B9F6CA": { id: 681, data: 1 },
        "#DCF1DE": { id: 682, data: 3 },
        "#DDEDC8": { id: 667, data: 10 },
        "#C5E1A6": { id: 668, data: 12 },
        "#AED582": { id: 669, data: 14 },
        "#9CCC66": { id: 680, data: 3 },
        "#8BC24A": { id: 672, data: 2 },
        "#7DB343": { id: 673, data: 4 },
        "#689F39": { id: 674, data: 6 },
        "#548B2E": { id: 675, data: 8 },
        "#33691E": { id: 676, data: 10 },
        "#64DD16": { id: 677, data: 12 },
        "#76FF02": { id: 678, data: 14 },
        "#B2FF59": { id: 675, data: 7 },
        "#CDFF90": { id: 681, data: 2 },
        "#ECF9DF": { id: 682, data: 4 },
        "#F0F4C2": { id: 667, data: 11 },
        "#E6EE9B": { id: 668, data: 13 },
        "#DDE776": { id: 669, data: 15 },
        "#D4E056": { id: 671, data: 1 },
        "#CDDC39": { id: 672, data: 0 },
        "#C0CA33": { id: 673, data: 5 },
        "#B0B42B": { id: 674, data: 7 },
        "#9E9E24": { id: 675, data: 9 },
        "#817716": { id: 1967, data: 0 },
        "#AEEA00": { id: 1963, data: 0 },
        "#C6FF00": { id: 678, data: 15 },
        "#EEFF41": { id: 680, data: 1 },
        "#F4FE81": { id: 681, data: 3 },
        "#F7FADB": { id: 682, data: 5 },
        "#FFFAC3": { id: 667, data: 12 },
        "#FFF59C": { id: 668, data: 14 },
        "#FFF176": { id: 1964, data: 0 },
        "#FFEE58": { id: 671, data: 2 },
        "#FFEB3C": { id: 672, data: 4 },
        "#FDD734": { id: 673, data: 6 },
        "#FAC02E": { id: 674, data: 8 },
        "#F9A825": { id: 675, data: 10 },
        "#F47F16": { id: 676, data: 12 },
        "#FFD600": { id: 677, data: 14 },
        "#FFEA00": { id: 675, data: 14 },
        "#FFFF00": { id: 680, data: 2 },
        "#FFFF8D": { id: 681, data: 4 },
        "#FFFCDD": { id: 682, data: 6 },
        "#FFECB2": { id: 667, data: 13 },
        "#FFE083": { id: 668, data: 15 },
        "#FFD54F": { id: 670, data: 1 },
        "#FFC928": { id: 671, data: 3 },
        "#FEC107": { id: 672, data: 5 },
        "#FFB200": { id: 673, data: 7 },
        "#FF9F00": { id: 674, data: 9 },
        "#FF8E01": { id: 675, data: 11 },
        "#FF6F00": { id: 676, data: 13 },
        "#FFAB00": { id: 677, data: 15 },
        "#FEC400": { id: 679, data: 1 },
        "#FFD741": { id: 671, data: 0 },
        "#FEE580": { id: 681, data: 5 },
        "#FFF4D6": { id: 682, data: 7 },
        "#FFE0B2": { id: 667, data: 14 },
        "#FFCC80": { id: 1965, data: 0 },
        "#FFB64D": { id: 670, data: 2 },
        "#FFA827": { id: 671, data: 4 },
        "#FF9700": { id: 672, data: 6 },
        "#FB8C00": { id: 673, data: 8 },
        "#F67B01": { id: 674, data: 10 },
        "#EF6C00": { id: 668, data: 0 },
        "#E65100": { id: 676, data: 14 },
        "#FF6D00": { id: 672, data: 15 },
        "#FF9000": { id: 679, data: 2 },
        "#FFAB40": { id: 1961, data: 0 },
        "#FFD181": { id: 681, data: 6 },
        "#FFEFD6": { id: 682, data: 8 },
        "#FFCCBB": { id: 667, data: 15 },
        "#FFAB91": { id: 669, data: 1 },
        "#FF8A66": { id: 670, data: 3 },
        "#FF7143": { id: 671, data: 5 },
        "#FE5722": { id: 672, data: 7 },
        "#F5511E": { id: 673, data: 9 },
        "#E64A19": { id: 674, data: 11 },
        "#D74315": { id: 675, data: 13 },
        "#BF360C": { id: 676, data: 15 },
        "#DD2C00": { id: 678, data: 1 },
        "#FF3D00": { id: 1960, data: 0 },
        "#FF6E41": { id: 680, data: 5 },
        "#FF9E81": { id: 681, data: 7 },
        "#FFE3E0": { id: 682, data: 9 },
        "#D7CCC8": { id: 669, data: 2 },
        "#BCABA4": { id: 670, data: 4 },
        "#A0887E": { id: 671, data: 6 },
        "#8C6E63": { id: 672, data: 8 },
        "#795547": { id: 1969, data: 0 },
        "#6D4D42": { id: 674, data: 12 },
        "#5D4038": { id: 679, data: 0 },
        "#4D342F": { id: 672, data: 9 },
        "#3E2622": { id: 678, data: 2 },
        "#000000": { id: 669, data: 3 },
        "#FFFFFF": { id: 667, data: 0 },
        "#EEEEEE": { id: 670, data: 5 },
        "#E0E0E0": { id: 671, data: 7 },
        "#BDBDBD": { id: 675, data: 0 },
        "#9E9E9E": { id: 673, data: 11 },
        "#757575": { id: 674, data: 13 },
        "#616161": { id: 674, data: 0 },
        "#424242": { id: 677, data: 1 },
        "#212121": { id: 682, data: 0 },
        "#EBEFF2": { id: 679, data: 4 },
        "#CFD8DD": { id: 680, data: 6 },
        "#90A4AD": { id: 681, data: 8 },
        "#78909C": { id: 682, data: 10 },
        "#607D8B": { id: 679, data: 5 },
        "#546F7A": { id: 680, data: 7 },
        "#36474F": { id: 681, data: 9 },
        "#273238": { id: 682, data: 11 }
    };
    function nearestColor(r, g, b) {
      let best = { id: 667, data: 0 }; // mặc định
      let bestDist = Infinity;

      for (const hex in BlockColor) {
        const bc = BlockColor[hex];
        const R = parseInt(hex.slice(1, 3), 16);
        const G = parseInt(hex.slice(3, 5), 16);
        const B = parseInt(hex.slice(5, 7), 16);

        const dist = (r - R) ** 2 + (g - G) ** 2 + (b - B) ** 2;
        if (dist < bestDist) {
          bestDist = dist;
          best = bc;
        }
      }
      return best;
    }

    document.addEventListener('DOMContentLoaded', function() {
      const uploadArea = document.getElementById('uploadBox');
      const fileInput = document.getElementById('jsonFile');
      const convertBtn = document.getElementById('convertBtn');
      const output = document.getElementById('output');
      const fileName = document.querySelector('.file-name');
      const copyBtn = document.getElementById('copyBtn');
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notificationText');
      
      uploadArea.addEventListener('click', () => fileInput.click());

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#4cc9f0';
        uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.3)';
      });
      
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#4361ee';
        uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#4361ee';
        uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFileSelection();
        }
      });
      
      fileInput.addEventListener('change', handleFileSelection);
      
      function handleFileSelection() {
        if (fileInput.files.length) {
          const file = fileInput.files[0];
          fileName.textContent = file.name;
          convertBtn.disabled = false;
        } else {
          fileName.textContent = 'Chưa có file nào được chọn';
          convertBtn.disabled = true;
        }
      }
      
      convertBtn.addEventListener('click', () => {
        if (!fileInput.files.length) {
          showNotification('Vui lòng chọn file trước!', 'error');
          return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = e => {
          try {
            const json = JSON.parse(e.target.result);
            if (!Array.isArray(json.voxels)) throw new Error('File không có mảng voxels');
            
            const blocks = json.voxels.map(v => {
              const r = Number(v.red), g = Number(v.green), b = Number(v.blue);
              const hex = "#" + r.toString(16).padStart(2, "0").toUpperCase()
                            + g.toString(16).padStart(2, "0").toUpperCase()
                            + b.toString(16).padStart(2, "0").toUpperCase();

              let id = 667, data = 0;
              if (BlockColor[hex]) {
                id = BlockColor[hex].id;
                data = BlockColor[hex].data;
              } else {
                const nearest = nearestColor(r, g, b);
                id = nearest.id;
                data = nearest.data;
              }

              return { x: -Number(v.x), y: Number(v.y), z: -Number(v.z), id, data };
            });
            
            const luaScript = `-- Script được tạo từ: ${file.name}
-- Số lượng khối: ${blocks.length}

local blocks = {
${blocks.map(b => `  {x=${b.x}, y=${b.y}, z=${b.z}, id=${b.id}, data=${b.data}}`).join(',\n')}
}

ScriptSupportEvent:registerEvent("Game.AnyPlayer.EnterGame", function(e)
  local _, u = Player:getHostUin()
  uin = u
  Player:gainItems(uin, 959, 1, 1)
  Game:msgBox("Đặt khối gia củ và nhấp để dựng mô hình")
end)

ScriptSupportEvent:registerEvent("Player.ClickBlock", function(e)
  if e.blockid == 959 then
    Block:destroyBlock(e.x, e.y, e.z, false)
    for _, block in ipairs(blocks) do
      Block:setBlockAll(block.x + e.x, block.y + e.y, block.z + e.z, block.id, block.data)
    end
    Game:msgBox("Mô hình đã được dựng thành công!")
  end
end)

-- Mini World Script bởi Drububu Converter`;
            
            output.textContent = luaScript;
            showNotification('Chuyển đổi thành công! Sao chép script để sử dụng trong Mini World.', 'success');
          } catch (err) {
            showNotification('Lỗi file JSON: ' + err.message, 'error');
          }
        };
        
        reader.readAsText(file);
      });
      
      copyBtn.addEventListener('click', () => {
        const textarea = document.createElement('textarea');
        textarea.value = output.textContent;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showNotification('Đã sao chép script vào clipboard!', 'success');
      });
      
      function showNotification(message, type) {
        notificationText.textContent = message;
        notification.className = 'notification';
        if (type === 'success') {
          notification.style.background = '#2a9d8f';
        } else if (type === 'error') {
          notification.style.background = '#e63946';
        }
        notification.classList.add('show');
        setTimeout(() => notification.classList.remove('show'), 3000);
      }
      
      convertBtn.disabled = true;
    });
  </script>
</body>
</html>

